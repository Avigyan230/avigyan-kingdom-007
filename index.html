<!-- Full HTML for Avigyan Kingdom game with daily leaderboard, medals, and winner highlight -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avigyan Kingdom</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #fefcea, #f1da36);
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      font-size: 2.5em;
      color: #6b4e14;
      margin: 20px;
    }
    input, select, button {
      padding: 8px;
      margin: 5px;
    }
    button {
      background: #ffcc00;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    #timer {
      font-size: 1.2em;
      margin: 10px;
      color: #b22222;
    }
    #gameArea {
      height: 300px;
      position: relative;
      background: #fff3cd;
      margin: 20px auto;
      width: 300px;
      overflow: hidden;
    }
    .poop {
      position: absolute;
      top: 0;
      font-size: 24px;
    }
    #playAgainBtn {
      display: none;
      margin-top: 15px;
    }
    .leaderboard-table {
      margin: 20px auto;
      width: 60%;
      border-collapse: collapse;
    }
    .leaderboard-table th, .leaderboard-table td {
      border: 1px solid #ccc;
      padding: 10px;
    }
    .gold { background: gold; }
    .silver { background: silver; }
    .bronze { background: #cd7f32; }
    .winner-highlight {
      font-size: 1.2em;
      color: green;
      font-weight: bold;
    }
    .avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      margin-right: 6px;
      vertical-align: middle;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      getDocs,
      collection
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD-xD6K9L-y2vTLKStArK4NFG3ZgzBE62I",
      authDomain: "avigyan-kingdom.firebaseapp.com",
      projectId: "avigyan-kingdom",
      storageBucket: "avigyan-kingdom.appspot.com",
      messagingSenderId: "201196096111",
      appId: "1:201196096111:web:0d10f2a385efb021cf4201"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const users = {
      piku: "dhiku",
      chotu: "gadha",
      mam: "goru",
      gunja: "hagu",
      avigyan: "king"
    };

    let currentUser = "";

    function login() {
      const u = document.getElementById("username").value.toLowerCase();
      const p = document.getElementById("password").value.toLowerCase();
      if (users[u] === p) {
        currentUser = u;
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("gameBox").style.display = "block";
        document.getElementById("playerName").innerText = u;
        showLeaderboards();
      } else {
        document.getElementById("error").innerText = "Wrong credentials!";
      }
    }

    async function showLeaderboards() {
      try {
        const today = new Date().toISOString().slice(0, 10);
        const totalRef = collection(db, "scores");
        const dailyRef = collection(db, `daily-${today}`);

        const [totalSnap, dailySnap] = await Promise.all([
          getDocs(totalRef),
          getDocs(dailyRef)
        ]);

        const allUsers = Object.keys(users);

        const totalData = allUsers.map(name => {
          const docSnap = totalSnap.docs.find(d => d.id === name);
          const score = docSnap?.data()?.total || 0;
          return [name, score];
        });

        const dailyData = allUsers.map(name => {
          const docSnap = dailySnap.docs.find(d => d.id === name);
          const score = docSnap?.data()?.score || 0;
          return [name, score];
        });

        totalData.sort((a, b) => b[1] - a[1]);
        dailyData.sort((a, b) => b[1] - a[1]);

        const totalRows = document.querySelector("#totalBoard tbody");
        const dailyRows = document.querySelector("#dailyBoard tbody");

        totalRows.innerHTML = totalData.map(([name, score], i) => {
          const medal = i === 0 ? "🥇" : i === 1 ? "🥈" : i === 2 ? "🥉" : "";
          return `<tr class='${i === 0 ? "gold" : i === 1 ? "silver" : i === 2 ? "bronze" : ""}'><td>${i + 1}</td><td>${medal} ${name}</td><td>${score.toFixed(1)}</td></tr>`;
        }).join("");

        dailyRows.innerHTML = dailyData.map(([name, score], i) => {
          const medal = i === 0 ? "🥇" : i === 1 ? "🥈" : i === 2 ? "🥉" : "";
          return `<tr class='${i === 0 ? "gold" : i === 1 ? "silver" : i === 2 ? "bronze" : ""}'><td>${i + 1}</td><td>${medal} ${name}</td><td>${score.toFixed(1)}</td></tr>`;
        }).join("");

        document.getElementById("winnerHighlight").innerText = dailyData[0] ? `🎉 Today’s Winner: ${dailyData[0][0]} with ${dailyData[0][1]} points!` : "No plays today yet.";
      } catch (e) {
        console.error("Failed to load leaderboard", e);
      }
    }

    window.login = login;
    window.startGame = startGame;
  </script>
</head>
<body>
  <h1>🏰 Welcome to Avigyan Kingdom 🏰</h1>
  <div id="loginBox">
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p id="error" style="color:red"></p>
  </div>
  <div id="gameBox" style="display:none">
    <h2>Welcome, <span id="playerName"></span>!</h2>
    <p>🎯 Task: Tap falling poops!</p>
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
    <button onclick="startGame()">Start Game</button>
    <div id="timer"></div>
    <div id="scoreDisplay">Score: 0</div>
    <div id="gameArea"></div>
    <button id="playAgainBtn" onclick="startGame()">Play Again</button>

    <h3>🏆 All-Time Leaderboard</h3>
    <table class="leaderboard-table" id="totalBoard">
      <thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
      <tbody></tbody>
    </table>

    <h3>📅 Daily Leaderboard</h3>
    <div class="winner-highlight" id="winnerHighlight"></div>
    <table class="leaderboard-table" id="dailyBoard">
      <thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</body>
</html>


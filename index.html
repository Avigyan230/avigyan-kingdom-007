<!-- Full HTML for Avigyan Kingdom game with Firebase, leaderboard, game over animation, and error handling -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avigyan Kingdom</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #fefcea, #f1da36);
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      font-size: 2.5em;
      color: #6b4e14;
      margin: 20px;
    }
    input, select, button {
      padding: 8px;
      margin: 5px;
    }
    button {
      background: #ffcc00;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    #timer {
      font-size: 1.2em;
      margin: 10px;
      color: #b22222;
    }
    #gameArea {
      height: 300px;
      position: relative;
      background: #fff3cd;
      margin: 20px auto;
      width: 300px;
      overflow: hidden;
    }
    .poop {
      position: absolute;
      top: 0;
      font-size: 24px;
    }
    #playAgainBtn {
      display: none;
      margin-top: 15px;
    }
    .leaderboard-table {
      margin: 20px auto;
      width: 60%;
      border-collapse: collapse;
    }
    .leaderboard-table th, .leaderboard-table td {
      border: 1px solid #ccc;
      padding: 10px;
    }
    .gold { background: gold; }
    .silver { background: silver; }
    .bronze { background: #cd7f32; }
    #gameOverMsg {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2em;
      color: #b22222;
      background: white;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 0 10px #999;
      display: none;
      z-index: 10;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      getDocs,
      collection
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD-xD6K9L-y2vTLKStArK4NFG3ZgzBE62I",
      authDomain: "avigyan-kingdom.firebaseapp.com",
      projectId: "avigyan-kingdom",
      storageBucket: "avigyan-kingdom.appspot.com",
      messagingSenderId: "201196096111",
      appId: "1:201196096111:web:0d10f2a385efb021cf4201"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const users = {
      piku: "dhiku",
      chotu: "gadha",
      mam: "goru",
      gunja: "hagu",
      avigyan: "king"
    };

    let currentUser = "";

    function login() {
      const u = document.getElementById("username").value.toLowerCase();
      const p = document.getElementById("password").value.toLowerCase();
      if (users[u] === p) {
        currentUser = u;
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("gameBox").style.display = "block";
        document.getElementById("playerName").innerText = u;
        showLeaderboards();
      } else {
        document.getElementById("error").innerText = "Wrong credentials!";
      }
    }

    async function showLeaderboards() {
      try {
        const today = new Date().toISOString().slice(0, 10);
        const totalRef = collection(db, "scores");
        const dailyRef = collection(db, `daily-${today}`);

        const [totalSnap, dailySnap] = await Promise.all([
          getDocs(totalRef),
          getDocs(dailyRef)
        ]);

        const totalData = [];
        totalSnap.forEach(doc => {
          const data = doc.data();
          const total = typeof data.total === "number" ? data.total : 0;
          totalData.push([doc.id, total]);
        });

        const dailyData = [];
        dailySnap.forEach(doc => {
          const data = doc.data();
          const score = typeof data.score === "number" ? data.score : 0;
          dailyData.push([doc.id, score]);
        });

        totalData.sort((a, b) => b[1] - a[1]);
        dailyData.sort((a, b) => b[1] - a[1]);

        const totalRows = document.querySelector("#totalBoard tbody");
        totalRows.innerHTML = totalData.length === 0 ? "<tr><td colspan='3'>No scores yet</td></tr>" : "";
        totalData.forEach(([name, score], i) => {
          const tr = document.createElement("tr");
          if (i === 0) tr.classList.add("gold");
          if (i === 1) tr.classList.add("silver");
          if (i === 2) tr.classList.add("bronze");
          tr.innerHTML = `<td>${i + 1}</td><td>${name}</td><td>${score.toFixed(1)}</td>`;
          totalRows.appendChild(tr);
        });

        const dailyRows = document.querySelector("#dailyBoard tbody");
        dailyRows.innerHTML = dailyData.length === 0 ? "<tr><td colspan='3'>No plays today</td></tr>" : "";
        dailyData.forEach(([name, score], i) => {
          const tr = document.createElement("tr");
          if (i === 0) tr.classList.add("gold");
          if (i === 1) tr.classList.add("silver");
          if (i === 2) tr.classList.add("bronze");
          tr.innerHTML = `<td>${i + 1}</td><td>${name}</td><td>${score.toFixed(1)}</td>`;
          dailyRows.appendChild(tr);
        });
      } catch (e) {
        console.error("Failed to load leaderboards", e);
      }
    }

    window.login = login;
    window.startGame = startGame;
  </script>
</head>
<body>
  <h1>üè∞ Welcome to Avigyan Kingdom üè∞</h1>
  <div id="loginBox">
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p id="error" style="color:red"></p>
  </div>
  <div id="gameBox" style="display:none">
    <h2>Welcome, <span id="playerName"></span>!</h2>
    <p>üéØ Task: Tap falling poops!</p>
    <select id="difficulty">
      <option value="easy">Easy</option>
      <option value="medium">Medium</option>
      <option value="hard">Hard</option>
    </select>
    <button onclick="startGame()">Start Game</button>
    <div id="timer"></div>
    <div id="scoreDisplay">Score: 0</div>
    <div id="gameArea"></div>
    <button id="playAgainBtn" onclick="startGame()">Play Again</button>
    <h3>üèÜ All-Time Leaderboard</h3>
    <table class="leaderboard-table" id="totalBoard">
      <thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
      <tbody></tbody>
    </table>
    <h3>üéâ Today's Top Scorer</h3>
    <table class="leaderboard-table" id="dailyBoard">
      <thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</body>
</html>
